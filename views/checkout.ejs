<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRIS Transaction</title>
</head>
<body>

    <div class="loader-bg">
        <div class="loadingio-spinner-typing-xprgxbsyl4">
            <div class="ldio-b5rzs5omc1l">
                <div style="left:30.150000000000002px;background:#ffffff;animation-delay:-0.37499999999999994s;"></div>
                <div style="left:50.25px;background:#ffffff;animation-delay:-0.28124999999999994s;"></div>
                <div style="left:70.35000000000001px;background:#ffffff;animation-delay:-0.18749999999999997s;"></div>
                <div style="left:90.45px;background:#ffffff;animation-delay:-0.09374999999999999s;"></div>
            </div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <div class="auth-main">
        <div class="auth-wrapper v1">
            <div class="auth-form">
                <div class="card my-5">
                    <div class="card-body">
                        <div class="text-center">
                            <img src="https://i.ibb.co.com/KDNkssr/IMG-20240603-173706-729.jpg" width="60"><br>
                            Hosei APIs
                        </div>
                        <div class="saprator my-3">
                            <span>Donasi</span>
                        </div>
                        <form id="qrisForm" action="/buysc" method="GET">
				                  <div class="form-group mb-3">
                          <label for="customAmount">Username:</label>
                          <input class="form-control " type="text" id="username" name="query" readonly placeholder="Enter amount" value="<%= username %>">
                          </div>
				                  <div class="form-group mb-3">
                          <label for="customAmount">Email:</label>
                          <input class="form-control " type="email" id="email" name="query" readonly placeholder="Enter amount" value="<%= username %>">
                          </div>
				                  <div class="form-group mb-3">
                          <label for="customAmount">Amount:</label>
                          <input class="form-control" type="number" id="customAmount" name="query" placeholder="Enter amount" min="1000">
                          </div>
                        <div class="mt-3" style="margin: 0 auto;display: table">                  </div>
                        <div class="d-grid mt-3">
                          <button type="submit" class="btn btn-primary">Sumbit</button>
                          </div>
                      </form>
                      <div id="resultContainer" style="display: none;">
                                  <div class="card my-5">
                                      <div class="card-body">
                      <h5 class="text-center text-muted f-w-500 mb-7">Transaction Result</h5>
                      <div class="table-responsive">
                      <table class="table">
                          <p id="status"></p>
                          <p id="qrUrl"></p>
                          <p id="noRef"></p>
                          <p id="harga"></p>
                          <p id="fee"></p>
                          <p id="total"></p>
                          <p id="method"></p>
                        </table>
                      </div>
                  
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

    <script>
      document.getElementById('qrisForm').addEventListener('submit', async function(event) {
          event.preventDefault();
  
          const customAmount = document.getElementById('customAmount').value;
          const username = document.getElementById('username').value;
          const email = document.getElementById('email').value;
          const response = await fetch(`/buysc?query=${customAmount}&username=${username}&email=${email}`);
          const data = await response.json();
  
          // Update result container with response data
          document.getElementById('status').innerText = `Status: ${data.status}`;
          document.getElementById('noRef').innerText = `Reference Number: ${data.no_ref}`;
          document.getElementById('harga').innerText = `Amount Received: ${data.harga}`;
          document.getElementById('fee').innerText = `Total Fee: ${data.fee}`;
          document.getElementById('total').innerText = `Total Amount: ${data.total}`;
          document.getElementById('method').innerText = `Payment Method: ${data.method}`;
  
          // Generate and display QR code image
          const qrCodeContainer = document.getElementById('qrUrl');
          qrCodeContainer.innerHTML = '';
  
          const qrCode = new QRCode(qrCodeContainer, {
              text: data.qr_url,
              width: 128,
              height: 128,
          });
  
          // Show the result container
          document.getElementById('resultContainer').style.display = 'block';
      });
  </script>


</body>
</html>